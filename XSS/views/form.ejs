<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <title>Unsafe Form 1</title>
</head>

<body style="text-align: center;">
    <script>
        <%= script %>
        var key = "<%= key %>";
        setTimeout(() => {
            key = "";
        }, 200);
        var alert2 = alert;

        alert = function (asdf) {
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.onreadystatechange = function () {
                if (xmlHttp.readyState == 4 && xmlHttp.status == 200) {
                    if (xmlHttp.responseText == "success") {
                        alert2("Mission accomplished!\n" + asdf);
                        window.parent.postMessage("success", '*');            
                    }
                }
            }
            xmlHttp.open("GET", "/challenge/<%= index %>/" + key, true); // true for asynchronous 
            xmlHttp.send(null);
        }
    </script>
    <h2>Post your comment!</h2>
    <form action="./<%= index %>" method="POST">
        <textarea name="text" rows="4" cols="50" placeholder="Type your comment here!"></textarea>
        <br>
        <input type="submit" value="Submit!"></input>
    </form>

    <% for (var c of comments) { %>
        <div class="comment"><%- c %></div>
    <% } %>
</body>

</html>